.. _ja_howto_location:

Location-aware master selection: 位置を考慮したマスタ選出
=========================================================================

.. contents::
   :backlinks: none
   :local:

目的
----------------------

データセンタの停電や災害によるデータの損失を防ぐためには、地理的に離れたロケーションにデータを複製しておく必要があります。

LS4では、レプリカセットに離れたロケーションに設置したサーバを追加しておくことで、そのようなレプリケーションが可能です。さらにDSやGWに対して「サーバがどこのロケーションに設置されているか」という情報を与えておくと、GWは地理的に近くに設置されたDSに対して優先的にデータの読み書きを行います。

::

    東京（プライマリ） --location=tokyo
    +- - - - - - - - - - - - - - - - - - - - - - - - - - +
    |                                                    |
       +----------+  +----------+  +----------+  +----+   
    |  |  App/GW  |  |  App/GW  |  |  App/GW  |  | CS |  |   
       +----------+  +----------+  +----------+  +----+   
    |                                                    |
       +------+    +------+    +------+       +-------+   
    |  |  DS  |    |  DS  |    |  DS  |       |  MDS  |  |
       +--|---+    +--|---+    +--|---+       +---|---+   
    |     |           |           |               |      |
       +--|---+    +--|---+    +--|---+       +---|---+   
    |  |  DS  |    |  DS  |    |  DS  |       |  MDS  |  |
       +--|---+    +--|---+    +--|---+       +---|---+   
    |     |           |           |               |      |
    +- - -|- - - - - -|- - - - - -|- - - - - - - -|- - - +
          |           |           |               |       
          |           |           |               |       
    +- - -|- - - - - -|- - - - - -|- - - - - - - -|- - - +
    |     |           |           |               |      |
       +--|---+    +--|---+    +--|---+       +---|---+   
    |  |  DS  |    |  DS  |    |  DS  |       |  MDS  |  |
       +------+    +------+    +------+       +-------+   
    |                                                    |
    +- - - - - - - - - - - - - - - - - - - - - - - - - - +
    カリフォルニア（バックアップ） --location=california

関連： :ref:`ja_arch_replica_set`


DSとGWの設定
----------------------

*ls4-ds* または *ls4-gw* コマンドに *--location* 引数を指定します。

DSやGWは、同じ *--location* 引数が指定されたDSに対して優先的にデータの読み書きを行います。

関連： :ref:`ja_command`

